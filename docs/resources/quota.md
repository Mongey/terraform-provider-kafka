---
page_title: "kafka_quota Resource - terraform-provider-kafka"
subcategory: ""
description: |-
  A resource for managing Kafka quotas to control resource usage by clients, users, or IP addresses.
---

# kafka_quota (Resource)

The `kafka_quota` resource manages Kafka quotas, which are used to limit resource usage and prevent any single client from monopolizing broker resources. Quotas can be applied to clients, users, or IP addresses to control bandwidth and request rates.

## Example Usage

### Client ID Quota

```terraform
# Limit a specific client's bandwidth
resource "kafka_quota" "mobile_app" {
  entity_name = "mobile-app-v1"
  entity_type = "client-id"

  config = {
    "consumer_byte_rate" = "5000000" # 5 MB/s consumer bandwidth
    "producer_byte_rate" = "2500000" # 2.5 MB/s producer bandwidth
    "request_percentage" = "200"     # 200% of a single CPU
  }
}
```

### User Quota

```terraform
# Set quotas for a specific user
resource "kafka_quota" "service_account" {
  entity_name = "payment-service"
  entity_type = "user"

  config = {
    "consumer_byte_rate" = "10000000" # 10 MB/s consumer bandwidth
    "producer_byte_rate" = "10000000" # 10 MB/s producer bandwidth
    "request_percentage" = "400"      # 400% of a single CPU
  }
}
```

### Default User Quota

```terraform
# Set default quotas for all users (when entity_name is omitted)
resource "kafka_quota" "default_user" {
  entity_type = "user"

  config = {
    "consumer_byte_rate" = "2000000" # 2 MB/s default consumer bandwidth
    "producer_byte_rate" = "1000000" # 1 MB/s default producer bandwidth
    "request_percentage" = "100"     # 100% of a single CPU
  }
}
```

### IP Address Quota

```terraform
# Rate limit connections from a specific IP
resource "kafka_quota" "external_ip" {
  entity_name = "203.0.113.0"
  entity_type = "ip"

  config = {
    "connection_creation_rate" = "10" # Max 10 connections per second
  }
}
```

## Import

Kafka quotas can be imported using the entity type and name:

```shell
# For named entities
terraform import kafka_quota.example client-id:my-client

# For default quotas (no entity name)
terraform import kafka_quota.default_user user:
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `entity_type` (String) The type of the entity (client-id, user, ip)

### Optional

- `config` (Map of Number) A map of string k/v properties.
- `entity_name` (String) The name of the entity (if entity_name is not provided, it will create entity-default Kafka quota)

### Read-Only

- `id` (String) The ID of this resource.

## Quota Configuration Options

### Bandwidth Quotas
- `producer_byte_rate` - The maximum bytes per second that can be produced by the entity
- `consumer_byte_rate` - The maximum bytes per second that can be consumed by the entity

### Request Rate Quotas
- `request_percentage` - The percentage of CPU time on each broker that the entity can use for requests. Values > 100% indicate multiple CPUs (e.g., 200% = 2 CPUs)

### Connection Quotas (IP-based only)
- `connection_creation_rate` - The maximum rate of new connections per second from the IP address

## Quota Precedence

When multiple quotas apply to a request, Kafka uses the most specific quota:

1. `/config/users/<user>/clients/<client-id>` (most specific)
2. `/config/users/<user>/clients/<default>`
3. `/config/users/<user>`
4. `/config/users/<default>/clients/<client-id>`
5. `/config/users/<default>/clients/<default>`
6. `/config/users/<default>` (least specific)

## Best Practices

1. **Start with Conservative Defaults**: Set reasonable default quotas for all users/clients and then create specific quotas for services that need higher limits.

2. **Monitor Quota Usage**: Use Kafka metrics to monitor quota utilization and adjust as needed. Look for throttling metrics to identify when quotas are being hit.

3. **Use Request Percentage Carefully**: The `request_percentage` quota affects CPU usage. Values over 100% mean the client can use more than one CPU core.

4. **Plan for Growth**: Set quotas with some headroom to accommodate traffic growth, but not so high that a misbehaving client can impact the cluster.

5. **Different Quotas for Different Environments**: Use stricter quotas in development/staging environments compared to production.

-> **Note:** Quotas are applied immediately but may take a few seconds to propagate across all brokers.